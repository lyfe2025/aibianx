# éƒ¨ç½²è¿ç»´æŒ‡å— ğŸš€

> ğŸ“‹ AIå˜ç°ä¹‹è·¯é¡¹ç›®çš„å®Œæ•´éƒ¨ç½²è¿ç»´æŒ‡å—ï¼Œæ¶µç›–å¼€å‘ç¯å¢ƒæ­å»ºã€ç”Ÿäº§éƒ¨ç½²ã€æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦ç­‰

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

| éƒ¨ç½²ä¿¡æ¯ | è¯¦æƒ… |
|---------|------|
| **å‰ç«¯æ¡†æ¶** | Next.js 14 (App Router) |
| **éƒ¨ç½²æ–¹å¼** | Vercel (æ¨è) / è‡ªå»ºæœåŠ¡å™¨ |
| **æ„å»ºå·¥å…·** | Turbopack |
| **ç¯å¢ƒç®¡ç†** | å¼€å‘/æµ‹è¯•/ç”Ÿäº§ä¸‰ç¯å¢ƒ |
| **CDNåŠ é€Ÿ** | Vercel Edge Network |
| **åŸŸåç®¡ç†** | Cloudflare DNS |

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### ç³»ç»Ÿè¦æ±‚
```bash
# å¿…éœ€è½¯ä»¶ç‰ˆæœ¬
Node.js >= 18.17.0
npm >= 9.6.7
Git >= 2.40.0

# æ¨èè½¯ä»¶
VSCode + Cursor
Chrome/Edge æµè§ˆå™¨
```

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/aibianx/aibianx.git
cd aibianx

# 2. å®‰è£…ä¾èµ–
cd frontend
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. æµè§ˆå™¨è®¿é—®
open http://localhost:3000
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# frontend/.env.local
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:8000/v1

# ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret

# åˆ†æå·¥å…·ï¼ˆå¯é€‰ï¼‰
NEXT_PUBLIC_GA_ID=your_google_analytics_id
NEXT_PUBLIC_HOTJAR_ID=your_hotjar_id
```

### å¼€å‘æœåŠ¡å™¨é…ç½®
```javascript
// next.config.ts
const nextConfig = {
  // å¼€å‘ç¯å¢ƒä¼˜åŒ–
  experimental: {
    turbo: {
      rules: {
        '*.svg': ['@svgr/webpack'],
      },
    },
  },
  
  // çƒ­é‡è½½é…ç½®
  webpack: (config, { dev }) => {
    if (dev) {
      config.watchOptions = {
        poll: 1000,
        aggregateTimeout: 300,
      }
    }
    return config
  }
}
```

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### Verceléƒ¨ç½² (æ¨è)

#### 1. Vercel CLIéƒ¨ç½²
```bash
# å®‰è£…Vercel CLI
npm i -g vercel

# ç™»å½•Vercel
vercel login

# åˆå§‹åŒ–é¡¹ç›®
cd frontend
vercel

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
vercel --prod
```

#### 2. GitHubé›†æˆéƒ¨ç½²
```yaml
# .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Install dependencies
        run: |
          cd frontend
          npm ci
      
      - name: Build project
        run: |
          cd frontend
          npm run build
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: frontend
```

#### 3. Vercelé…ç½®æ–‡ä»¶
```json
// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "regions": ["sin1", "hkg1"],
  "functions": {
    "frontend/src/app/api/**": {
      "maxDuration": 30
    }
  },
  "headers": [
    {
      "source": "/fonts/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ],
  "redirects": [
    {
      "source": "/blog",
      "destination": "/weekly",
      "permanent": true
    }
  ]
}
```

### è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²

#### 1. Dockeréƒ¨ç½²
```dockerfile
# Dockerfile
FROM node:18-alpine AS deps
WORKDIR /app
COPY frontend/package.json frontend/package-lock.json ./
RUN npm ci --only=production

FROM node:18-alpine AS builder
WORKDIR /app
COPY frontend/ .
COPY --from=deps /app/node_modules ./node_modules
RUN npm run build

FROM node:18-alpine AS runner
WORKDIR /app
ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs
EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  frontend:
    build: 
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_APP_URL=https://aibianx.com
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - frontend
    restart: unless-stopped
```

#### 2. Nginxé…ç½®
```nginx
# nginx.conf
upstream frontend {
    server frontend:3000;
}

server {
    listen 80;
    server_name aibianx.com www.aibianx.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name aibianx.com www.aibianx.com;
    
    # SSLé…ç½®
    ssl_certificate /etc/nginx/ssl/aibianx.com.crt;
    ssl_certificate_key /etc/nginx/ssl/aibianx.com.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_types
        text/plain
        text/css
        text/js
        text/javascript
        application/javascript
        application/json
        image/svg+xml;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        proxy_pass http://frontend;
    }
    
    # ä»£ç†åˆ°Next.js
    location / {
        proxy_pass http://frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

## ğŸ”§ ç¯å¢ƒç®¡ç†

### ç¯å¢ƒé…ç½®
```bash
# å¼€å‘ç¯å¢ƒ (.env.local)
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:8000/v1

# æµ‹è¯•ç¯å¢ƒ (.env.staging)
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://staging.aibianx.com
NEXT_PUBLIC_API_URL=https://api-staging.aibianx.com/v1

# ç”Ÿäº§ç¯å¢ƒ (.env.production)
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://aibianx.com
NEXT_PUBLIC_API_URL=https://api.aibianx.com/v1
```

### æ„å»ºä¼˜åŒ–
```javascript
// next.config.ts
const nextConfig = {
  // ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
  output: 'standalone',
  compress: true,
  poweredByHeader: false,
  
  // å›¾ç‰‡ä¼˜åŒ–
  images: {
    formats: ['image/webp', 'image/avif'],
    domains: ['aibianx.com'],
    minimumCacheTTL: 31536000,
  },
  
  // å­—ä½“ä¼˜åŒ–
  experimental: {
    fontLoaders: [
      { loader: '@next/font/google', options: { subsets: ['latin'] } },
    ],
  },
  
  // Bundleåˆ†æ
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        fs: false,
        net: false,
        tls: false,
      }
    }
    
    // Bundleå¤§å°åˆ†æ
    if (process.env.ANALYZE === 'true') {
      const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer')
      config.plugins.push(
        new BundleAnalyzerPlugin({
          analyzerMode: 'static',
          openAnalyzer: false,
        })
      )
    }
    
    return config
  },
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æ„å»ºæ€§èƒ½ä¼˜åŒ–
```bash
# å¹¶è¡Œæ„å»º
TURBO_TEAM=your-team npm run build

# å¢é‡æ„å»º
npm run build -- --experimental-build-cache

# Bundleåˆ†æ
ANALYZE=true npm run build
npm run analyze
```

### è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–
```typescript
// app/layout.tsx - æ€§èƒ½ä¼˜åŒ–é…ç½®
import { Metadata } from 'next'

// é¢„åŠ è½½å…³é”®èµ„æº
export const metadata: Metadata = {
  other: {
    'resource-hints': [
      '<link rel="preload" href="/fonts/alibaba-puhuiti.woff2" as="font" crossorigin>',
      '<link rel="dns-prefetch" href="//api.aibianx.com">',
    ].join(''),
  },
}

// å…³é”®CSSå†…è”
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <head>
        <style dangerouslySetInnerHTML={{
          __html: `
            /* å…³é”®è·¯å¾„CSS */
            :root{--color-bg-primary:#030303}
            body{background:var(--color-bg-primary)}
          `
        }} />
      </head>
      <body>{children}</body>
    </html>
  )
}
```

### å›¾ç‰‡ä¼˜åŒ–
```typescript
// å“åº”å¼å›¾ç‰‡ç»„ä»¶
import Image from 'next/image'

export function OptimizedImage({
  src,
  alt,
  width,
  height,
  priority = false,
}: {
  src: string
  alt: string
  width: number
  height: number
  priority?: boolean
}) {
  return (
    <Image
      src={src}
      alt={alt}
      width={width}
      height={height}
      priority={priority}
      placeholder="blur"
      blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      style={{
        objectFit: 'cover',
        objectPosition: 'center',
      }}
    />
  )
}
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### Vercel Analyticsé›†æˆ
```typescript
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react'
import { SpeedInsights } from '@vercel/speed-insights/next'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  )
}
```

### é”™è¯¯ç›‘æ§
```typescript
// lib/error-monitoring.ts
class ErrorMonitoring {
  static init() {
    if (typeof window !== 'undefined') {
      window.addEventListener('error', this.handleError)
      window.addEventListener('unhandledrejection', this.handlePromiseRejection)
    }
  }
  
  static handleError(event: ErrorEvent) {
    console.error('Global error:', event.error)
    
    // å‘é€åˆ°ç›‘æ§æœåŠ¡
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        type: 'javascript',
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        stack: event.error?.stack,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString(),
      }),
    })
  }
  
  static handlePromiseRejection(event: PromiseRejectionEvent) {
    console.error('Unhandled promise rejection:', event.reason)
    
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        type: 'promise',
        reason: event.reason?.toString(),
        stack: event.reason?.stack,
        timestamp: new Date().toISOString(),
      }),
    })
  }
}

export default ErrorMonitoring
```

### æ€§èƒ½ç›‘æ§
```typescript
// lib/performance-monitoring.ts
export class PerformanceMonitoring {
  static reportWebVitals(metric: any) {
    // Core Web Vitalsç›‘æ§
    const { name, value, id } = metric
    
    // å‘é€åˆ°åˆ†ææœåŠ¡
    if (typeof window !== 'undefined') {
      ;(window as any).gtag?.('event', 'web_vitals', {
        event_category: 'Performance',
        event_label: name,
        value: Math.round(name === 'CLS' ? value * 1000 : value),
        custom_parameter_1: id,
        non_interaction: true,
      })
    }
    
    // å‘é€åˆ°è‡ªå®šä¹‰ç›‘æ§
    fetch('/api/analytics/web-vitals', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name,
        value,
        id,
        timestamp: Date.now(),
      }),
    })
  }
}

// app/layout.tsx
import { reportWebVitals } from '@/lib/performance-monitoring'

export { reportWebVitals }
```

---

## ğŸ” å®‰å…¨é…ç½®

### CSPå®‰å…¨ç­–ç•¥
```typescript
// next.config.ts
const nextConfig = {
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Content-Security-Policy',
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-eval' 'unsafe-inline' *.vercel-analytics.com *.google-analytics.com",
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: blob: *.aibianx.com",
              "font-src 'self' data:",
              "connect-src 'self' *.vercel-analytics.com *.google-analytics.com api.aibianx.com",
              "frame-ancestors 'none'",
            ].join('; '),
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
        ],
      },
    ]
  },
}
```

### ç¯å¢ƒå˜é‡å®‰å…¨
```bash
# æ•æ„Ÿä¿¡æ¯ç®¡ç†
# .env.local (ä¸è¦æäº¤åˆ°Git)
DATABASE_URL=postgresql://...
JWT_SECRET=your-super-secret-key
GITHUB_CLIENT_SECRET=your-github-secret
STRIPE_SECRET_KEY=sk_test_...

# Vercelç¯å¢ƒå˜é‡é…ç½®
vercel env add DATABASE_URL production
vercel env add JWT_SECRET production
vercel env add GITHUB_CLIENT_SECRET production
```

---

## ğŸ“ˆ SEOä¼˜åŒ–

### Metaæ ‡ç­¾ä¼˜åŒ–
```typescript
// app/layout.tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: {
    template: '%s | AIå˜ç°ä¹‹è·¯',
    default: 'AIå˜ç°ä¹‹è·¯ - ä¸“ä¸šçš„AIå•†ä¸šåŒ–å¹³å°',
  },
  description: 'æ±‡èšAIé¢†åŸŸä¸“å®¶å®æˆ˜ç»éªŒï¼Œæ¯å‘¨åˆ†äº«æœ€æ–°å˜ç°æœºä¼šä¸å®ç”¨å·¥å…·',
  keywords: ['AIå˜ç°', 'ChatGPT', 'Midjourney', 'äººå·¥æ™ºèƒ½', 'AIå·¥å…·'],
  
  openGraph: {
    type: 'website',
    locale: 'zh_CN',
    url: 'https://aibianx.com',
    siteName: 'AIå˜ç°ä¹‹è·¯',
    images: [{
      url: '/og-image.jpg',
      width: 1200,
      height: 630,
      alt: 'AIå˜ç°ä¹‹è·¯',
    }],
  },
  
  twitter: {
    card: 'summary_large_image',
    site: '@aibianx',
    creator: '@aibianx',
  },
  
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
  
  verification: {
    google: 'your-google-site-verification',
    baidu: 'your-baidu-site-verification',
  },
}
```

### ç»“æ„åŒ–æ•°æ®
```typescript
// components/StructuredData.tsx
export function ArticleStructuredData({ article }: { article: Article }) {
  const structuredData = {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: article.title,
    description: article.excerpt,
    image: article.coverImage,
    author: {
      '@type': 'Person',
      name: article.author.name,
    },
    publisher: {
      '@type': 'Organization',
      name: 'AIå˜ç°ä¹‹è·¯',
      logo: {
        '@type': 'ImageObject',
        url: '/logo.png',
      },
    },
    datePublished: article.publishedAt,
    dateModified: article.updatedAt,
  }
  
  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(structuredData) }}
    />
  )
}
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è¯Šæ–­

#### æ„å»ºå¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜
rm -rf .next node_modules package-lock.json
npm install
npm run build

# æ£€æŸ¥ä¾èµ–å†²çª
npm ls
npm audit

# è°ƒè¯•æ„å»ºè¿‡ç¨‹
DEBUG=* npm run build
```

#### éƒ¨ç½²å¤±è´¥
```bash
# Verceléƒ¨ç½²æ—¥å¿—
vercel logs

# æ£€æŸ¥ç¯å¢ƒå˜é‡
vercel env ls

# é‡æ–°éƒ¨ç½²
vercel --force
```

#### æ€§èƒ½é—®é¢˜
```bash
# åˆ†æBundleå¤§å°
npm run analyze

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
node --max-old-space-size=4096 node_modules/.bin/next build

# å¯ç”¨æ€§èƒ½åˆ†æ
NEXT_PUBLIC_PERFORMANCE_DEBUG=true npm run dev
```

### ç›‘æ§å‘Šè­¦
```yaml
# .github/workflows/health-check.yml
name: Health Check

on:
  schedule:
    - cron: '*/5 * * * *'  # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - name: Check website availability
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" https://aibianx.com)
          if [ $response -ne 200 ]; then
            echo "Website is down! HTTP code: $response"
            exit 1
          fi
          echo "Website is healthy"
      
      - name: Check API availability
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" https://api.aibianx.com/v1/health)
          if [ $response -ne 200 ]; then
            echo "API is down! HTTP code: $response"
            exit 1
          fi
          echo "API is healthy"
      
      - name: Notify if failed
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

---

## ğŸ“ è¿ç»´æ”¯æŒ

### è¿ç»´å›¢é˜Ÿè”ç³»æ–¹å¼
- **ç´§æ€¥æ•…éšœ**: ops-emergency@aibianx.com
- **æ—¥å¸¸è¿ç»´**: ops@aibianx.com
- **ç›‘æ§å‘Šè­¦**: ä¼ä¸šå¾®ä¿¡ç¾¤ã€Slacké¢‘é“

### è¿ç»´å·¥å…·
- **ç›‘æ§å¹³å°**: Vercel Analytics + è‡ªå»ºç›‘æ§
- **æ—¥å¿—ç³»ç»Ÿ**: Vercel Logs + ELK Stack
- **å‘Šè­¦ç³»ç»Ÿ**: PagerDuty + ä¼ä¸šå¾®ä¿¡
- **å¤‡ä»½ç­–ç•¥**: æ•°æ®åº“å®šæ—¶å¤‡ä»½ + ä»£ç Gitç®¡ç†

### è¿ç»´æµç¨‹
1. **å‘å¸ƒæµç¨‹**: å¼€å‘ â†’ æµ‹è¯• â†’ é¢„å‘å¸ƒ â†’ ç”Ÿäº§
2. **å›æ»šæœºåˆ¶**: Vercelä¸€é”®å›æ»š + æ•°æ®åº“å¤‡ä»½æ¢å¤
3. **åº”æ€¥å“åº”**: 15åˆ†é’Ÿå†…å“åº” + 1å°æ—¶å†…ä¿®å¤
4. **ä¾‹è¡Œç»´æŠ¤**: æ¯å‘¨æ—¥å‡Œæ™¨2-4ç‚¹ç»´æŠ¤çª—å£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**ç»´æŠ¤å›¢é˜Ÿ**: AIå˜ç°ä¹‹è·¯è¿ç»´å›¢é˜Ÿ  

*æŒç»­ä¼˜åŒ–éƒ¨ç½²æµç¨‹ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šå¯é * ğŸš€ 