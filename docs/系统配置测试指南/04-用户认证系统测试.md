# 04 - 用户认证系统测试

> **第四步：测试完整的用户认证系统**

---

## 🎯 测试目标

验证用户认证系统的完整功能：
- ✅ 邮箱注册登录
- ✅ GitHub OAuth登录
- ✅ Google OAuth登录
- ✅ 邮箱验证
- ✅ 密码重置
- ✅ 会话管理

---

## ✅ 步骤1：基础认证测试

### 邮箱注册测试

1. 访问：http://localhost
2. 点击"注册"
3. 填写信息：
   - 邮箱：`test@localhost.test`
   - 用户名：`testuser`
   - 密码：`test123456`
4. 提交注册
5. 检查邮箱：http://localhost:8080/roundcube

### 邮箱登录测试

1. 点击"登录"
2. 使用注册的邮箱和密码登录
3. 验证登录成功，跳转到用户profile

---

## ✅ 步骤2：OAuth认证配置

### GitHub OAuth配置

1. 访问：https://github.com/settings/applications/new
2. 创建OAuth App：
   - Application name: `AI变现之路-开发`
   - Homepage URL: `http://localhost`
   - Authorization callback URL: `http://localhost/api/auth/callback/github`
3. 获取 Client ID 和 Client Secret

### Google OAuth配置

1. 访问：https://console.cloud.google.com/
2. 创建项目并启用Google+ API
3. 创建OAuth 2.0凭据：
   - 授权JavaScript来源：`http://localhost`
   - 授权重定向URI：`http://localhost/api/auth/callback/google`
4. 获取客户端ID和密钥

### 配置环境变量

编辑 `frontend/.env.local`：

```bash
# GitHub OAuth
NEXTAUTH_GITHUB_ID=你的GitHub客户端ID
NEXTAUTH_GITHUB_SECRET=你的GitHub客户端密钥

# Google OAuth
NEXTAUTH_GOOGLE_ID=你的Google客户端ID
NEXTAUTH_GOOGLE_SECRET=你的Google客户端密钥

# NextAuth配置
NEXTAUTH_URL=http://localhost
NEXTAUTH_SECRET=你的NextAuth密钥
```

---

## ✅ 步骤3：OAuth登录测试

### GitHub登录测试

1. 重启前端服务：`cd frontend && npm run dev`
2. 访问：http://localhost
3. 点击"GitHub登录"
4. 授权GitHub访问
5. 验证登录成功并创建用户

### Google登录测试

1. 点击"Google登录"
2. 选择Google账户
3. 授权访问
4. 验证登录成功

---

## ✅ 步骤4：邮箱验证测试

### 验证邮箱功能

1. 使用未验证的邮箱注册
2. 检查验证邮件：http://localhost:8080/roundcube
3. 点击验证链接
4. 验证邮箱状态更新

### 重发验证邮件

1. 登录未验证账户
2. 点击"重发验证邮件"
3. 检查新的验证邮件

---

## ✅ 步骤5：密码重置测试

### 密码重置流程

1. 在登录页面点击"忘记密码"
2. 输入注册邮箱
3. 检查重置邮件：http://localhost:8080/roundcube
4. 点击重置链接
5. 设置新密码
6. 使用新密码登录

---

## ✅ 步骤6：会话管理测试

### 会话持久化

1. 登录用户账户
2. 关闭浏览器
3. 重新打开，验证仍然登录
4. 测试会话过期机制

### 多设备登录

1. 在不同浏览器/设备登录同一账户
2. 验证会话同步
3. 在一个设备退出登录
4. 验证其他设备会话状态

---

## ✅ 步骤7：用户数据同步测试

### 用户信息同步

1. 使用OAuth登录
2. 检查Strapi后台用户数据：http://localhost:1337/admin
3. 验证用户信息正确同步：
   - 用户名
   - 邮箱
   - 头像
   - 登录方式
   - BillionMail订阅状态

---

## ✅ 步骤8：API认证测试

### 测试认证API

```bash
# 测试注册API
curl -X POST http://localhost/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"api-test@test.com","username":"apiuser","password":"test123456"}'

# 测试登录API
curl -X POST http://localhost/api/auth/signin \
  -H "Content-Type: application/json" \
  -d '{"email":"api-test@test.com","password":"test123456"}'

# 测试密码重置API
curl -X POST http://localhost/api/auth/forgot-password \
  -H "Content-Type: application/json" \
  -d '{"email":"api-test@test.com"}'
```

---

## 🎯 测试完成标志

- ✅ 邮箱注册登录正常
- ✅ GitHub OAuth登录正常
- ✅ Google OAuth登录正常
- ✅ 邮箱验证功能正常
- ✅ 密码重置功能正常
- ✅ 会话管理正常
- ✅ 用户数据同步正常
- ✅ 认证API响应正确
- ✅ 邮件通知正常发送

**完成后进入下一步：完整系统集成测试**