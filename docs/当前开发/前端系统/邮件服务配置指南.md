# 邮件服务配置指南

> **通用SMTP邮件服务配置，支持多种邮件服务商**

---

## 🎯 **配置目的**

为AI变现之路项目配置邮件发送服务，用于：
- **邮箱验证码** - 用户注册时的邮箱验证
- **密码重置** - 发送密码重置链接
- **系统通知** - 重要操作的邮件提醒

---

## ⚙️ **通用配置说明**

### **环境变量配置**
在 `frontend/.env.local` 文件中配置：

```bash
# 邮件服务配置（通用SMTP配置）
EMAIL_SERVER_HOST=your-smtp-host        # SMTP服务器地址
EMAIL_SERVER_PORT=587                   # SMTP端口（通常是587或465）
EMAIL_SERVER_USER=your-smtp-username    # SMTP用户名
EMAIL_SERVER_PASSWORD=your-smtp-password # SMTP密码
EMAIL_FROM=noreply@yourdomain.com       # 发件人显示地址
```

### **配置参数说明**
- **EMAIL_SERVER_HOST**: SMTP服务器地址
- **EMAIL_SERVER_PORT**: SMTP端口（587=TLS, 465=SSL, 25=明文）
- **EMAIL_SERVER_USER**: 登录SMTP服务器的用户名
- **EMAIL_SERVER_PASSWORD**: 登录SMTP服务器的密码或API密钥
- **EMAIL_FROM**: 邮件发送方显示地址（收件人看到的发件人）

---

## 📧 **主流邮件服务商配置**

### **1. Gmail（免费，适合开发测试）**
```bash
EMAIL_SERVER_HOST=smtp.gmail.com
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=your-email@gmail.com
EMAIL_SERVER_PASSWORD=your-app-password  # 16位应用密码
EMAIL_FROM=noreply@yourdomain.com
```

**配置步骤：**
1. 开启Gmail两步验证
2. 生成应用密码：https://myaccount.google.com/apppasswords
3. 使用应用密码而非登录密码

**优缺点：**
- ✅ 免费稳定，配置简单
- ❌ 每天限制500封邮件

### **2. SendGrid（推荐生产环境）**
```bash
EMAIL_SERVER_HOST=smtp.sendgrid.net
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=apikey
EMAIL_SERVER_PASSWORD=your_sendgrid_api_key
EMAIL_FROM=noreply@yourdomain.com
```

**配置步骤：**
1. 注册SendGrid账户：https://sendgrid.com
2. 创建API Key：Settings > API Keys
3. 用户名固定为 "apikey"

**优缺点：**
- ✅ 专业服务，送达率高，统计完善
- ✅ 每天免费100封，付费方案丰富
- ❌ 需要域名验证

### **3. 阿里云邮件推送（国内推荐）**
```bash
EMAIL_SERVER_HOST=smtpdm.aliyun.com
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=your-username@your-domain.com
EMAIL_SERVER_PASSWORD=your-smtp-password
EMAIL_FROM=noreply@your-domain.com
```

**配置步骤：**
1. 开通阿里云邮件推送服务
2. 添加并验证发信域名
3. 创建SMTP凭证

**优缺点：**
- ✅ 国内服务，速度快
- ✅ 每天免费200封邮件
- ❌ 需要备案域名

### **4. 腾讯企业邮箱**
```bash
EMAIL_SERVER_HOST=smtp.exmail.qq.com
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=your-email@your-company.com
EMAIL_SERVER_PASSWORD=your-email-password
EMAIL_FROM=noreply@your-company.com
```

**配置步骤：**
1. 开通腾讯企业邮箱
2. 创建邮箱账户
3. 开启SMTP服务

**优缺点：**
- ✅ 企业级服务，安全性高
- ❌ 需要企业认证

### **5. Mailgun**
```bash
EMAIL_SERVER_HOST=smtp.mailgun.org
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=postmaster@your-domain.mailgun.org
EMAIL_SERVER_PASSWORD=your-mailgun-smtp-password
EMAIL_FROM=noreply@yourdomain.com
```

**配置步骤：**
1. 注册Mailgun账户
2. 添加并验证域名
3. 获取SMTP凭证

**优缺点：**
- ✅ 开发者友好，API丰富
- ✅ 每月免费5000封邮件
- ❌ 国外服务，国内可能较慢

### **6. 网易企业邮箱**
```bash
EMAIL_SERVER_HOST=smtp.ym.163.com
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER=your-email@your-domain.com
EMAIL_SERVER_PASSWORD=your-email-password
EMAIL_FROM=noreply@your-domain.com
```

---

## 🧪 **测试邮件配置**

### **简单测试脚本**
创建 `test-email.js`：
```javascript
const nodemailer = require('nodemailer');

const transporter = nodemailer.createTransporter({
  host: process.env.EMAIL_SERVER_HOST,
  port: process.env.EMAIL_SERVER_PORT,
  secure: false, // TLS
  auth: {
    user: process.env.EMAIL_SERVER_USER,
    pass: process.env.EMAIL_SERVER_PASSWORD,
  },
});

// 发送测试邮件
transporter.sendMail({
  from: process.env.EMAIL_FROM,
  to: 'your-test-email@example.com',
  subject: 'AI变现之路 - 邮件服务测试',
  text: '如果您收到这封邮件，说明邮件服务配置成功！',
}, (error, info) => {
  if (error) {
    console.log('发送失败:', error);
  } else {
    console.log('发送成功:', info.response);
  }
});
```

### **测试步骤**
```bash
# 1. 安装nodemailer（如果未安装）
npm install nodemailer

# 2. 运行测试
node test-email.js

# 3. 检查测试邮箱是否收到邮件
```

---

## 🔧 **常见问题排查**

### **连接超时**
```
Error: Connection timeout
```
**解决方案：**
- 检查SMTP服务器地址是否正确
- 确认网络防火墙没有阻止SMTP端口
- 尝试使用不同的端口（587、465、25）

### **认证失败**
```
Error: Invalid login
```
**解决方案：**
- 检查用户名和密码是否正确
- 确认SMTP服务已开启
- 使用API密钥而非登录密码（如SendGrid）

### **邮件被拒绝**
```
Error: Message rejected
```
**解决方案：**
- 检查发件人地址是否已验证
- 确认域名已通过SPF/DKIM验证
- 避免使用垃圾邮件关键词

### **发送失败**
```
Error: Sending failed
```
**解决方案：**
- 检查发送限额是否超出
- 确认收件人邮箱地址正确
- 查看邮件服务商的发送日志

---

## 📊 **服务商选择建议**

### **开发阶段**
- **Gmail**: 免费、简单、够用
- **Mailgun**: 免费额度大，API友好

### **生产环境**
- **国外用户**: SendGrid、Mailgun
- **国内用户**: 阿里云邮件推送
- **企业应用**: 腾讯企业邮箱、网易企业邮箱

### **选择标准**
1. **发送量需求**: 每天需要发送多少封邮件
2. **送达率要求**: 是否需要高送达率
3. **成本预算**: 免费额度是否足够
4. **用户地域**: 国内/国外用户比例
5. **功能需求**: 是否需要详细统计、API等

---

## 🛡️ **安全最佳实践**

### **环境变量保护**
- 生产环境使用平台环境变量配置
- 不要将SMTP凭证提交到版本控制
- 定期更换SMTP密码

### **发送频率控制**
- 实现发送频率限制
- 防止恶意大量发送
- 监控异常发送行为

### **邮件内容安全**
- 使用HTML邮件模板
- 防范邮件注入攻击
- 过滤用户输入内容

---

**配置负责人**：开发团队  
**最后更新**：2025年1月3日  
**版本**：v1.0  
**支持的服务商**：Gmail、SendGrid、阿里云、腾讯、Mailgun、网易