# 系统配置组件化重构方案

## 问题现状
当前系统配置采用平铺结构，44个字段混合在一个表单中，包含用户注册、OAuth、密码策略、维护模式等不同功能，管理界面混乱，与支付配置的清晰分组形成强烈对比。

## 重构目标
将系统配置改为组件化结构，参考支付配置的成功经验，按功能域分组管理。

## 重构方案

### 1. 组件分组设计

#### userManagement（用户管理配置）
```json
{
  "registrationEnabled": "用户注册开关",
  "emailVerificationEnabled": "邮箱验证开关", 
  "passwordResetEnabled": "密码重置开关",
  "enableUserProfileEdit": "用户资料编辑权限",
  "enableAccountDeletion": "账号删除权限",
  "enableUserListPublic": "用户列表公开",
  "maxAvatarSize": "头像最大尺寸"
}
```

#### passwordPolicy（密码策略配置）
```json
{
  "passwordMinLength": "密码最小长度",
  "passwordRequireSpecialChar": "密码特殊字符要求",
  "passwordRequireNumber": "密码数字要求", 
  "passwordRequireUppercase": "密码大写字母要求"
}
```

#### verificationSettings（验证设置配置）
```json
{
  "verificationCodeLength": "验证码长度",
  "verificationCodeExpiry": "验证码有效期",
  "passwordResetTokenExpiry": "重置令牌有效期"
}
```

#### oauthSettings（OAuth登录配置）
```json
{
  "oauthEnabled": "OAuth登录总开关",
  "oauthAutoRegister": "OAuth自动注册",
  "githubOauth": {
    "enabled": "GitHub登录开关",
    "clientId": "GitHub客户端ID",
    "clientSecret": "GitHub客户端密钥", 
    "callbackUrl": "GitHub回调地址"
  },
  "googleOauth": {
    "enabled": "Google登录开关",
    "clientId": "Google客户端ID",
    "clientSecret": "Google客户端密钥",
    "callbackUrl": "Google回调地址" 
  },
  "wechatOauth": {
    "enabled": "微信登录开关",
    "appId": "微信AppID",
    "appSecret": "微信AppSecret",
    "callbackUrl": "微信回调地址"
  },
  "qqOauth": {
    "enabled": "QQ登录开关", 
    "appId": "QQ互联AppID",
    "appSecret": "QQ互联AppSecret",
    "callbackUrl": "QQ回调地址"
  }
}
```

#### securitySettings（安全设置配置）
```json
{
  "sessionTimeout": "会话超时时间",
  "maxLoginAttempts": "最大登录尝试次数",
  "accountLockoutDuration": "账号锁定时长",
  "allowedEmailDomains": "允许的邮箱域名",
  "blockedEmailDomains": "禁止的邮箱域名"
}
```

#### systemMaintenance（系统维护配置）
```json
{
  "maintenanceMode": "维护模式",
  "maintenanceMessage": "维护提示信息"
}
```

### 2. 新的schema结构
```json
{
  "kind": "singleType",
  "collectionName": "system_configs",
  "info": {
    "singularName": "system-config",
    "pluralName": "system-configs", 
    "displayName": "系统配置",
    "description": "系统功能配置管理 - 分组管理邮件服务、OAuth第三方登录、用户注册等系统功能配置"
  },
  "attributes": {
    "configName": {
      "type": "string",
      "default": "系统配置"
    },
    
    "userManagement": {
      "type": "component",
      "component": "system.user-management-config",
      "required": true,
      "description": "用户管理配置"
    },
    
    "passwordPolicy": {
      "type": "component", 
      "component": "system.password-policy-config",
      "required": true,
      "description": "密码策略配置"
    },
    
    "verificationSettings": {
      "type": "component",
      "component": "system.verification-settings-config", 
      "required": true,
      "description": "验证设置配置"
    },
    
    "oauthSettings": {
      "type": "component",
      "component": "system.oauth-settings-config",
      "description": "OAuth登录配置"
    },
    
    "securitySettings": {
      "type": "component",
      "component": "system.security-settings-config",
      "required": true, 
      "description": "安全设置配置"
    },
    
    "systemMaintenance": {
      "type": "component",
      "component": "system.system-maintenance-config",
      "description": "系统维护配置"
    }
  }
}
```

### 3. 重构优势
1. **清晰分组**：每个功能域独立管理，易于查找和配置
2. **组件复用**：OAuth配置组件可在其他地方复用 
3. **界面友好**：后台管理界面按功能分组展示，提升用户体验
4. **扩展性强**：新增功能配置时可独立添加组件
5. **一致性**：与支付配置保持相同的设计模式

### 4. 实施计划
1. **创建组件定义**：定义6个system配置组件
2. **数据迁移脚本**：将现有数据迁移到新结构
3. **API兼容性**：确保现有API调用不受影响
4. **测试验证**：验证所有功能正常运行
5. **文档更新**：更新配置说明文档

## 预期效果
重构后，系统配置将与支付配置一样清晰易管理，提升管理员操作体验，降低配置错误率。