{
  "kind": "collectionType",
  "collectionName": "payments",
  "info": {
    "singularName": "payment",
    "pluralName": "payments",
    "displayName": "支付记录",
    "description": "支付记录系统 - 管理所有支付交易记录和第三方支付信息"
  },
  "options": {
    "draftAndPublish": false
  },
  "pluginOptions": {},
  "attributes": {
    "order": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::order.order",
      "required": true,
      "description": "关联订单"
    },
    "user": {
      "type": "relation",
      "relation": "manyToOne", 
      "target": "plugin::users-permissions.user",
      "required": true,
      "description": "支付用户"
    },
    
    "paymentNo": {
      "type": "string",
      "required": true,
      "unique": true,
      "maxLength": 100,
      "description": "支付流水号（唯一标识）"
    },
    "paymentMethod": {
      "type": "enumeration",
      "enum": [
        "alipay",
        "wechat",
        "stripe",
        "points"
      ],
      "required": true,
      "description": "支付方式：支付宝/微信/Stripe/积分"
    },
    "amount": {
      "type": "decimal",
      "required": true,
      "description": "支付金额（单位：分）"
    },
    "currency": {
      "type": "string",
      "default": "CNY",
      "maxLength": 10,
      "description": "货币类型：CNY/USD等"
    },
    
    "thirdPartyOrderNo": {
      "type": "string",
      "maxLength": 200,
      "description": "第三方平台订单号"
    },
    "thirdPartyTransactionId": {
      "type": "string", 
      "maxLength": 200,
      "description": "第三方交易ID"
    },
    "thirdPartyResponse": {
      "type": "json",
      "description": "第三方完整响应数据"
    },
    "gatewayFee": {
      "type": "decimal",
      "default": 0,
      "description": "支付网关手续费（单位：分）"
    },
    
    "status": {
      "type": "enumeration",
      "enum": [
        "pending",
        "success", 
        "failed",
        "cancelled",
        "refunded"
      ],
      "default": "pending",
      "description": "支付状态"
    },
    "failReason": {
      "type": "text",
      "description": "支付失败原因"
    },
    
    "completedAt": {
      "type": "datetime",
      "description": "支付完成时间"
    },
    "notifiedAt": {
      "type": "datetime",
      "description": "回调通知时间"
    },
    
    "reconciled": {
      "type": "boolean",
      "default": false,
      "description": "是否已对账"
    },
    "reconciledAt": {
      "type": "datetime",
      "description": "对账时间"
    },
    
    "ipAddress": {
      "type": "string",
      "maxLength": 45,
      "description": "支付时的IP地址"
    },
    "userAgent": {
      "type": "text",
      "description": "支付时的用户代理"
    }
  }
}