# Strapi åŽç«¯å¼€å‘è§„èŒƒ (Strapi Backend Rules)

## ðŸš¨ **é“å¾‹è­¦å‘Šï¼šæ–°å»ºå†…å®¹ç±»åž‹åŽå¿…é¡»ç«‹å³é…ç½®æ•°æ®åº“æ³¨é‡Šå’Œå­—æ®µæè¿°ï¼**

**âš ï¸ è¿™æ˜¯å¼ºåˆ¶æ€§è¦æ±‚ï¼Œä»»ä½•è·³è¿‡éƒ½æ˜¯ä¸¥é‡é”™è¯¯ï¼**
- ðŸ—ƒï¸ **æ•°æ®åº“è¡¨æ³¨é‡Š** - æ¯ä¸ªè¡¨å¿…é¡»æ·»åŠ ä¸­æ–‡æè¿°
- ðŸ—ƒï¸ **æ•°æ®åº“å­—æ®µæ³¨é‡Š** - æ¯ä¸ªå­—æ®µå¿…é¡»æ·»åŠ ä¸­æ–‡æè¿°  
- ðŸŽ¨ **Adminå­—æ®µæè¿°** - æ¯ä¸ªå­—æ®µå¿…é¡»é…ç½®ä¸­æ–‡æè¿°æ˜¾ç¤º
- ðŸ” **å¼ºåˆ¶éªŒè¯æ£€æŸ¥** - å¿…é¡»éªŒè¯é…ç½®æ•ˆæžœ

**è¿ååŽæžœï¼š**
- æ•°æ®åº“ç»´æŠ¤å›°éš¾ï¼Œå­—æ®µå«ä¹‰ä¸æ˜Ž
- Adminç•Œé¢æ˜¾ç¤ºè‹±æ–‡ï¼Œç®¡ç†å‘˜æ— æ³•ä½¿ç”¨
- å›¢é˜Ÿåä½œæ•ˆçŽ‡ä½Žï¼Œç”Ÿäº§çŽ¯å¢ƒæ•…éšœæŽ’æŸ¥å›°éš¾

---

## ðŸš¨ Strapi 5.x å…³é”®é”™è¯¯é¢„é˜²

### **å¿…é¡»ä½¿ç”¨TypeScript + ES6è¯­æ³•**
```typescript
// âœ… æ­£ç¡®æ ¼å¼
import { factories } from '@strapi/strapi'
export default factories.createCoreController('api::article.article');

// âŒ é”™è¯¯æ ¼å¼ - ä¼šå¯¼è‡´404
const { createCoreController } = require('@strapi/strapi').factories;
module.exports = createCoreController('api::article.article');
```

### **å…³é”®æ³¨æ„äº‹é¡¹**
- âŒ åˆ é™¤ `content-types/{name}/index.js` æ–‡ä»¶ (å¯¼è‡´å†²çª)
- âœ… å¿…é¡»ä½¿ç”¨ `.ts` æ‰©å±•å
- âœ… ä¼˜å…ˆä½¿ç”¨Adminç•Œé¢åˆ›å»ºå†…å®¹ç±»åž‹
- âœ… åˆ›å»ºåŽç«‹å³é…ç½®Publicè§’è‰²æƒé™

### **å¿«é€Ÿé—®é¢˜è¯Šæ–­**
```bash
# 1. æµ‹è¯•APIçŠ¶æ€
curl -s "http://localhost:1337/api/articles" | jq '.error.status'
# 404 = æœªè¯†åˆ«æ ¼å¼ | 403 = éœ€è¦æƒé™ | 200 = æ­£å¸¸

# 2. æ£€æŸ¥æ–‡ä»¶æ ¼å¼
find src/api -name "*.js" -o -name "*.ts" | sort
# åº”è¯¥åªæœ‰.tsæ–‡ä»¶

# 3. ä¿®å¤é‡å¯
rm -rf .tmp && npm run develop
```

### **æƒé™è‡ªåŠ¨åŒ–é…ç½® (æŽ¨è)**
åœ¨ `backend/src/index.ts` æ·»åŠ bootstrapå‡½æ•°è‡ªåŠ¨é…ç½®æƒé™ï¼š
```typescript
export default {
  async bootstrap({ strapi }) {
    const publicRole = await strapi.entityService.findMany('plugin::users-permissions.role', {
      filters: { type: 'public' }
    });
    
    const permissions = [
      'api::article.article.find', 'api::article.article.findOne',
      'api::author.author.find', 'api::category.category.find',
      'api::tag.tag.find', 'api::site-config.site-config.find',
      'api::seo-metrics.seo-metrics.find'
    ];
    
    // è‡ªåŠ¨åˆ›å»º/å¯ç”¨æƒé™é€»è¾‘...
  }
};
```

## ðŸ”¥ **æ–°å»ºå†…å®¹ç±»åž‹æ ‡å‡†æµç¨‹ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰**

**ðŸš¨ é“å¾‹è­¦å‘Šï¼šæ–°å»ºä»»ä½•å†…å®¹ç±»åž‹åŽï¼Œå¿…é¡»ç«‹å³æ‰§è¡Œæ•°æ®åº“æ³¨é‡Šå’Œå­—æ®µæè¿°é…ç½®ï¼**
**âš ï¸ è¿™ä¸æ˜¯å¯é€‰æ­¥éª¤ï¼Œæ˜¯å¼ºåˆ¶æ€§è¦æ±‚ï¼ä»»ä½•è·³è¿‡éƒ½æ˜¯é”™è¯¯çš„ï¼**

### **ç¬¬ä¸€æ­¥ï¼šAdminç•Œé¢åˆ›å»ºå†…å®¹ç±»åž‹**
```bash
# 1. è¿›å…¥Strapiç®¡ç†åŽå°
http://localhost:1337/admin â†’ Content-Type Builder

# 2. åˆ›å»ºå†…å®¹ç±»åž‹æ—¶å¿…é¡»éµå¾ªçš„å‘½åè§„èŒƒ
- ç±»åž‹åç§°ï¼šä½¿ç”¨è‹±æ–‡å°å†™ï¼Œå•æ•°å½¢å¼ï¼ˆå¦‚ï¼šarticle, author, categoryï¼‰
- æ˜¾ç¤ºåç§°ï¼šä½¿ç”¨ä¸­æ–‡ï¼Œä¾¿äºŽç®¡ç†å‘˜ç†è§£ï¼ˆå¦‚ï¼šæ–‡ç« ç®¡ç†, ä½œè€…ç®¡ç†ï¼‰
- API IDï¼šç¡®ä¿ä¸Žç±»åž‹åç§°ä¸€è‡´
```

### **ç¬¬äºŒæ­¥ï¼šðŸš¨ å¼ºåˆ¶æ‰§è¡Œæ•°æ®åº“æ³¨é‡Šå’Œå­—æ®µæè¿°é…ç½®**
```bash
# ðŸ”¥ æ–°å»ºå†…å®¹ç±»åž‹åŽï¼Œç»å¯¹ä¸èƒ½è·³è¿‡ä»¥ä¸‹å‘½ä»¤ï¼š
./scripts.sh content-type configure [content-type-name]

# ðŸš¨ å¦‚æžœè„šæœ¬ä¸å­˜åœ¨ï¼Œå¿…é¡»æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å¼ºåˆ¶æ­¥éª¤ï¼š

# æ­¥éª¤1ï¼šðŸ—ƒï¸ å¼ºåˆ¶ç”Ÿæˆæ•°æ®åº“è¡¨æ³¨é‡Šï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
cat > backend/add-db-comments-${content_type}.sql << EOF
-- å¼ºåˆ¶æ•°æ®åº“æ³¨é‡Š - ${content_type}
COMMENT ON TABLE ${table_name} IS '${ä¸­æ–‡è¡¨æè¿°}';
COMMENT ON COLUMN ${table_name}.å­—æ®µå IS 'ä¸­æ–‡å­—æ®µæè¿°';
-- ... ä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ æ³¨é‡Š
EOF

psql -U aibianx_dev -d aibianx_dev -f backend/add-db-comments-${content_type}.sql

# æ­¥éª¤2ï¼šðŸŽ¨ å¼ºåˆ¶ç”Ÿæˆå­—æ®µæè¿°é…ç½®ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
cat > backend/update-field-descriptions-${content_type}.sql << EOF
-- å¼ºåˆ¶å­—æ®µæè¿°é…ç½® - ${content_type}
UPDATE strapi_core_store_settings 
SET value = jsonb_set(
    value::jsonb, 
    '{metadatas,å­—æ®µå,edit,description}', 
    '"ä¸­æ–‡å­—æ®µæè¿°"'
) 
WHERE key = 'plugin_content_manager_configuration_content_types::api::${content_type}.${content_type}';
-- ... ä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ æè¿°
EOF

psql -U aibianx_dev -d aibianx_dev -f backend/update-field-descriptions-${content_type}.sql

# æ­¥éª¤3ï¼šðŸ”„ å¼ºåˆ¶æ¸…é™¤ç¼“å­˜å¹¶é‡å¯ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
./scripts.sh deploy stop
rm -rf backend/.tmp backend/.cache backend/build
./scripts.sh deploy start

# ðŸš¨ æ‰§è¡Œç»“æžœéªŒè¯ï¼ˆå¼ºåˆ¶æ£€æŸ¥ï¼‰ï¼š
# âœ… æ•°æ®åº“æ³¨é‡Šï¼šå¿…é¡»100%æ·»åŠ åˆ°æ‰€æœ‰è¡¨å’Œå­—æ®µ
# âœ… Adminç•Œé¢å­—æ®µæè¿°ï¼šå¿…é¡»100%æ˜¾ç¤ºä¸­æ–‡æè¿°
# âœ… APIæƒé™ï¼šå¿…é¡»é…ç½®å¹¶éªŒè¯è®¿é—®æ­£å¸¸
# âŒ ä»»ä½•ä¸€é¡¹å¤±è´¥éƒ½å¿…é¡»é‡æ–°æ‰§è¡Œæ•´ä¸ªæµç¨‹
```

### **ç¬¬ä¸‰æ­¥ï¼šè‡ªåŠ¨éªŒè¯ï¼ˆæ— éœ€æ‰‹åŠ¨æ£€æŸ¥ï¼‰**
```bash
# ðŸ”¥ é…ç½®å‘½ä»¤ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰éªŒè¯ï¼Œè¾“å‡ºéªŒè¯ç»“æžœï¼š

# âœ… æ•°æ®åº“æ³¨é‡ŠéªŒè¯
# âœ… å­—æ®µæè¿°éªŒè¯
# âœ… APIæƒé™éªŒè¯
# âœ… ç®¡ç†ç•Œé¢éªŒè¯

# ðŸ“Š å¦‚æžœéªŒè¯å¤±è´¥ï¼Œå‘½ä»¤ä¼šè‡ªåŠ¨é‡è¯•å¹¶è¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
```

### **ðŸŽ¯ è‡ªåŠ¨åŒ–é…ç½®è„šæœ¬å®žçŽ°**

#### **è‡ªåŠ¨åŒ–è„šæœ¬åŠŸèƒ½è¯´æ˜Ž**
```bash
# ðŸ”¥ å®Œå…¨è‡ªåŠ¨åŒ–çš„å†…å®¹ç±»åž‹é…ç½®è„šæœ¬
# ä½ç½®ï¼šscripts/content-type/configure-content-type.sh

configure_content_type() {
    local content_type="$1"
    local table_name="${content_type//-/_}s"  # smtp-config -> smtp_configs
    
    echo "ðŸš€ å¼€å§‹é…ç½®å†…å®¹ç±»åž‹: $content_type"
    
    # 1. åœæ­¢æœåŠ¡å¹¶æ¸…é™¤ç¼“å­˜
    ./scripts.sh deploy stop
    cd backend && rm -rf .tmp .cache build dist node_modules/.cache
    cd ../frontend && rm -rf .next node_modules/.cache && cd ..
    
    # 2. è‡ªåŠ¨ç”Ÿæˆå¹¶æ‰§è¡Œæ•°æ®åº“è¡¨æ³¨é‡Š
    generate_table_comments "$content_type" "$table_name"
    
    # 3. è‡ªåŠ¨ç”Ÿæˆå¹¶æ‰§è¡Œå­—æ®µæè¿°é…ç½®
    generate_field_descriptions "$content_type"
    
    # 4. é‡å¯æœåŠ¡
    ./scripts.sh deploy start
    
    # 5. è‡ªåŠ¨éªŒè¯é…ç½®ç»“æžœ
    verify_configuration "$content_type" "$table_name"
    
    # 6. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    cleanup_temp_files "$content_type"
    
    echo "âœ… å†…å®¹ç±»åž‹ $content_type é…ç½®å®Œæˆï¼"
}
```

#### **è‡ªåŠ¨è¡¨æ³¨é‡Šç”Ÿæˆå™¨**
```bash
generate_table_comments() {
    local content_type="$1"
    local table_name="$2"
    
    echo "ðŸ“ ç”Ÿæˆæ•°æ®åº“è¡¨æ³¨é‡Š..."
    
    # è‡ªåŠ¨ç”Ÿæˆè¡¨æ³¨é‡ŠSQLï¼ˆåŸºäºŽå†…å®¹ç±»åž‹schema.jsonï¼‰
    cat > "backend/auto-db-comments-${content_type}.sql" << EOF
-- è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åº“æ³¨é‡Š - ${content_type}
-- ç”Ÿæˆæ—¶é—´: $(date)

-- ä»Žschema.jsonè‡ªåŠ¨æå–è¡¨æ³¨é‡Š
COMMENT ON TABLE ${table_name} IS '$(extract_table_description "$content_type")';

-- ä»Žschema.jsonè‡ªåŠ¨æå–å­—æ®µæ³¨é‡Š
$(generate_column_comments "$content_type" "$table_name")
EOF

    # æ‰§è¡ŒSQL
    cd backend && psql -U aibianx_dev -d aibianx_dev -f "auto-db-comments-${content_type}.sql"
}
```

#### **è‡ªåŠ¨å­—æ®µæè¿°ç”Ÿæˆå™¨**
```bash
generate_field_descriptions() {
    local content_type="$1"
    
    echo "ðŸŽ¨ ç”Ÿæˆå­—æ®µæè¿°é…ç½®..."
    
    # ç›´æŽ¥æ›´æ–°æ•°æ®åº“é…ç½®è¡¨
    cat > "backend/auto-field-descriptions-${content_type}.sql" << EOF
-- è‡ªåŠ¨ç”Ÿæˆçš„å­—æ®µæè¿°é…ç½® - ${content_type}
-- ç”Ÿæˆæ—¶é—´: $(date)

-- ä»Žschema.jsonè‡ªåŠ¨æå–å­—æ®µæè¿°å¹¶æ›´æ–°Strapié…ç½®
$(generate_field_description_updates "$content_type")
EOF

    # æ‰§è¡Œå­—æ®µæè¿°æ›´æ–°
    cd backend && psql -U aibianx_dev -d aibianx_dev -f "auto-field-descriptions-${content_type}.sql"
}
```

#### **è‡ªåŠ¨éªŒè¯å™¨**
```bash
verify_configuration() {
    local content_type="$1"
    local table_name="$2"
    
    echo "ðŸ” éªŒè¯é…ç½®ç»“æžœ..."
    
    # éªŒè¯æ•°æ®åº“æ³¨é‡Š
    local comment_count=$(psql -U aibianx_dev -d aibianx_dev -t -c "
        SELECT COUNT(*) FROM information_schema.columns cols 
        INNER JOIN pg_class pgc ON pgc.relname = cols.table_name 
        WHERE table_name = '$table_name' 
        AND col_description(pgc.oid, cols.ordinal_position) IS NOT NULL;
    ")
    
    echo "âœ… æ•°æ®åº“æ³¨é‡Š: $comment_count ä¸ªå­—æ®µå·²æ·»åŠ æ³¨é‡Š"
    
    # éªŒè¯å­—æ®µæè¿°é…ç½®
    local desc_count=$(psql -U aibianx_dev -d aibianx_dev -t -c "
        SELECT jsonb_object_keys(value::jsonb->'metadatas') 
        FROM strapi_core_store_settings 
        WHERE key = 'plugin_content_manager_configuration_content_types::api::${content_type}.${content_type}';
    " | wc -l)
    
    echo "âœ… å­—æ®µæè¿°: $desc_count ä¸ªå­—æ®µå·²é…ç½®æè¿°"
    
    # éªŒè¯APIè®¿é—®
    if curl -s "http://localhost:1337/api/${content_type}s" | grep -q "data"; then
        echo "âœ… APIè®¿é—®: æ­£å¸¸"
    else
        echo "âš ï¸ APIè®¿é—®: éœ€è¦é…ç½®æƒé™"
    fi
}
```

## ðŸŒ **åŸŸåé…ç½®æ ‡å‡†ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰**

### **âš ï¸ é‡è¦åŽŸåˆ™**
æ‰€æœ‰URLå’ŒåŸŸåé…ç½®å¿…é¡»ä½¿ç”¨çŽ¯å¢ƒå˜é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç ï¼ç¡®ä¿å¼€å‘çŽ¯å¢ƒã€ç”Ÿäº§çŽ¯å¢ƒé…ç½®ç»Ÿä¸€ç®¡ç†ã€‚

### **ðŸ”§ çŽ¯å¢ƒå˜é‡æ ‡å‡†é…ç½®**

#### **å‰ç«¯çŽ¯å¢ƒå˜é‡ (frontend/.env.local)**
```bash
# å‰ç«¯æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
NEXT_PUBLIC_FRONTEND_DOMAIN=localhost
NEXT_PUBLIC_FRONTEND_PORT=80
NEXT_PUBLIC_FRONTEND_PROTOCOL=http

# åŽç«¯æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
NEXT_PUBLIC_BACKEND_DOMAIN=localhost
NEXT_PUBLIC_BACKEND_PORT=1337
NEXT_PUBLIC_BACKEND_PROTOCOL=http

# æœç´¢æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
NEXT_PUBLIC_SEARCH_DOMAIN=localhost
NEXT_PUBLIC_SEARCH_PORT=7700
NEXT_PUBLIC_SEARCH_PROTOCOL=http

# NextAuthé…ç½®
NEXTAUTH_SECRET=your-secret-key
```

#### **åŽç«¯çŽ¯å¢ƒå˜é‡ (backend/.env)**
```bash
# åŽç«¯æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
BACKEND_DOMAIN=localhost
BACKEND_PORT=1337
BACKEND_PROTOCOL=http
HOST=0.0.0.0
PORT=1337

# å‰ç«¯æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
FRONTEND_DOMAIN=localhost
FRONTEND_PORT=80
FRONTEND_PROTOCOL=http

# æ•°æ®åº“æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=aibianx_dev
DATABASE_USERNAME=aibianx_dev
DATABASE_PASSWORD=aibianx_password

# æœç´¢æœåŠ¡é…ç½®ï¼ˆåŸŸåå’Œç«¯å£åˆ†ç¦»ï¼‰
MEILISEARCH_DOMAIN=localhost
MEILISEARCH_PORT=7700
MEILISEARCH_PROTOCOL=http
MEILISEARCH_API_KEY=

# å®‰å…¨é…ç½®
APP_KEYS=key1,key2,key3,key4
API_TOKEN_SALT=api-token-salt
ADMIN_JWT_SECRET=admin-jwt-secret
JWT_SECRET=jwt-secret
```

### **ðŸ”§ å­—æ®µæè¿°é…ç½®æ ‡å‡†æµç¨‹ï¼ˆå…³é”®ï¼‰**

**âš ï¸ é‡è¦æé†’**ï¼šå­—æ®µæè¿°é…ç½®å¤±è´¥æ˜¯åå¤å‡ºçŽ°çš„é—®é¢˜ï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ‰§è¡Œï¼

#### **é—®é¢˜ç—‡çŠ¶è¯†åˆ«**
- Adminç•Œé¢å­—æ®µæ²¡æœ‰ä¸­æ–‡æè¿°æ˜¾ç¤º
- æè¿°æ˜¾ç¤ºä¸ºç©ºæˆ–æ˜¾ç¤ºè‹±æ–‡å­—æ®µå
- é…ç½®åŽåˆ·æ–°é¡µé¢æè¿°æ¶ˆå¤±

#### **å¼ºåˆ¶è§£å†³æ–¹æ¡ˆï¼ˆ100%æœ‰æ•ˆï¼‰**

**ç¬¬ä¸€æ­¥ï¼šå½»åº•æ¸…é™¤æ‰€æœ‰ç¼“å­˜**
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts.sh deploy stop

# æ¸…é™¤åŽç«¯æ‰€æœ‰ç¼“å­˜ï¼ˆå…³é”®æ­¥éª¤ï¼‰
cd backend && rm -rf .tmp .cache build dist node_modules/.cache

# æ¸…é™¤å‰ç«¯ç¼“å­˜
cd ../frontend && rm -rf .next node_modules/.cache
```

**ç¬¬äºŒæ­¥ï¼šç›´æŽ¥æ›´æ–°æ•°æ®åº“é…ç½®**
```bash
# åˆ›å»ºå­—æ®µæè¿°æ›´æ–°è„šæœ¬
cat > backend/update-field-descriptions.sql << 'EOF'
-- æ›´æ–°Articleå­—æ®µæè¿°ï¼ˆç¤ºä¾‹ï¼‰
UPDATE strapi_core_store_settings 
SET value = jsonb_set(
    value::jsonb, 
    '{metadatas,featured,edit,description}', 
    '"æ˜¯å¦ç½®é¡¶æŽ¨èï¼šç”¨äºŽé¦–é¡µç²¾é€‰æŽ¨èï¼Œç½®é¡¶æ˜¾ç¤ºä¼˜è´¨å†…å®¹ï¼Œæå‡æ–‡ç« æ›å…‰åº¦"'
) 
WHERE key = 'plugin_content_manager_configuration_content_types::api::article.article';

UPDATE strapi_core_store_settings 
SET value = jsonb_set(
    value::jsonb, 
    '{metadatas,isPremium,edit,description}', 
    '"æ˜¯å¦ä¼šå‘˜ä¸“äº«ï¼šæ ‡è®°ä¸ºä¼šå‘˜ä¸“äº«çš„æ–‡ç« éœ€è¦ä¼šå‘˜æƒé™æ‰èƒ½æŸ¥çœ‹å®Œæ•´å†…å®¹ï¼Œç”¨äºŽä»˜è´¹å†…å®¹ç®¡ç†"'
) 
WHERE key = 'plugin_content_manager_configuration_content_types::api::article.article';
EOF

# æ‰§è¡Œæ•°æ®åº“æ›´æ–°
cd backend && psql -U aibianx_dev -d aibianx_dev -f update-field-descriptions.sql
```

**ç¬¬ä¸‰æ­¥ï¼šé‡å¯æœåŠ¡å¹¶å¼ºåˆ¶åˆ·æ–°**
```bash
# é‡å¯å¼€å‘çŽ¯å¢ƒï¼ˆä¼šè‡ªåŠ¨æ¸…é™¤ç¼“å­˜ï¼‰
./scripts.sh deploy start

# ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨åŽï¼Œå¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨
# æŒ‰ Ctrl+Shift+R (Windows) æˆ– Cmd+Shift+R (Mac)
```

### **ðŸš¨ å¼ºåˆ¶æ‰§è¡Œæ£€æŸ¥æ¸…å•ï¼ˆ100%å¿…é¡»å®Œæˆï¼‰**

**æ¯åˆ›å»ºä¸€ä¸ªå†…å®¹ç±»åž‹ï¼Œå¿…é¡»é€é¡¹æ£€æŸ¥ä»¥ä¸‹æ¸…å•ï¼Œä»»ä½•æœªå®Œæˆé¡¹éƒ½æ˜¯ä¸¥é‡é”™è¯¯ï¼**

#### **ç¬¬ä¸€çº§ï¼šæ•°æ®åº“å±‚é¢ï¼ˆç»å¯¹ä¸èƒ½è·³è¿‡ï¼‰**
- [ ] **ðŸ—ƒï¸ æ•°æ®åº“è¡¨æ³¨é‡Š** - å¿…é¡»ä¸ºæ¯ä¸ªè¡¨æ·»åŠ ä¸­æ–‡æè¿°æ³¨é‡Š
- [ ] **ðŸ—ƒï¸ æ•°æ®åº“å­—æ®µæ³¨é‡Š** - å¿…é¡»ä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ ä¸­æ–‡æè¿°æ³¨é‡Š
- [ ] **ðŸ—ƒï¸ å…³è”è¡¨æ³¨é‡Š** - å¿…é¡»ä¸ºå…³è”è¡¨æ·»åŠ æ³¨é‡Šè¯´æ˜Žå…³è”å…³ç³»

#### **ç¬¬äºŒçº§ï¼šç®¡ç†ç•Œé¢å±‚é¢ï¼ˆç»å¯¹ä¸èƒ½è·³è¿‡ï¼‰**
- [ ] **ðŸŽ¨ å­—æ®µæè¿°é…ç½®** - å¿…é¡»ä¸ºæ¯ä¸ªå­—æ®µé…ç½®ä¸­æ–‡æè¿°ï¼Œæ˜¾ç¤ºåœ¨Adminç•Œé¢
- [ ] **ðŸŽ¨ å­—æ®µæ ‡ç­¾é…ç½®** - å¿…é¡»é…ç½®ä¸­æ–‡å­—æ®µæ ‡ç­¾
- [ ] **ðŸŽ¨ å­—æ®µå¸®åŠ©æ–‡æœ¬** - å¿…é¡»ä¸ºå¤æ‚å­—æ®µæ·»åŠ å¸®åŠ©è¯´æ˜Ž

#### **ç¬¬ä¸‰çº§ï¼šæƒé™å’Œè®¿é—®å±‚é¢ï¼ˆç»å¯¹ä¸èƒ½è·³è¿‡ï¼‰**
- [ ] **ðŸ” Publicè§’è‰²æƒé™** - å¿…é¡»é…ç½®findå’ŒfindOneæƒé™
- [ ] **ðŸ” Authenticatedæƒé™** - å¿…é¡»é…ç½®ç›¸åº”çš„CRUDæƒé™
- [ ] **ðŸ” APIç«¯ç‚¹æµ‹è¯•** - å¿…é¡»éªŒè¯APIå¯æ­£å¸¸è®¿é—®

#### **ç¬¬å››çº§ï¼šå‰ç«¯é›†æˆå±‚é¢ï¼ˆå»ºè®®å®Œæˆï¼‰**
- [ ] **ðŸ“ TypeScriptç±»åž‹å®šä¹‰** - æ›´æ–°å‰ç«¯ç±»åž‹å®šä¹‰
- [ ] **ðŸ”— APIé›†æˆæµ‹è¯•** - å‰ç«¯èƒ½æ­£å¸¸è°ƒç”¨API
- [ ] **ðŸŽ¯ é¡µé¢é›†æˆéªŒè¯** - ç›¸å…³é¡µé¢èƒ½æ­£å¸¸å±•ç¤ºæ•°æ®

### **ðŸš¨ ç»å¯¹ç¦æ­¢çš„æ“ä½œï¼ˆè¿ååŽæžœè‡ªè´Ÿï¼‰**

#### **ðŸ’€ è‡´å‘½é”™è¯¯çº§åˆ«ï¼ˆå¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–ä¸¥é‡é—®é¢˜ï¼‰**
- âŒ **è·³è¿‡æ•°æ®åº“æ³¨é‡Š** - å°†å¯¼è‡´ï¼š
  - åŽæœŸç»´æŠ¤å›°éš¾ï¼Œå­—æ®µå«ä¹‰ä¸æ˜Ž
  - å›¢é˜Ÿåä½œæ•ˆçŽ‡ä½Žï¼Œéœ€è¦åå¤è¯¢é—®å­—æ®µå«ä¹‰
  - æ•°æ®åº“ç»“æž„æ–‡æ¡£ç¼ºå¤±
- âŒ **è·³è¿‡å­—æ®µæè¿°é…ç½®** - å°†å¯¼è‡´ï¼š
  - Adminç•Œé¢æ˜¾ç¤ºè‹±æ–‡å­—æ®µåï¼Œç®¡ç†å‘˜å›°æƒ‘
  - å†…å®¹ç®¡ç†æ•ˆçŽ‡ä½Žä¸‹ï¼Œéœ€è¦çŒœæµ‹å­—æ®µå«ä¹‰
  - éžæŠ€æœ¯äººå‘˜æ— æ³•ä½¿ç”¨åŽå°ç®¡ç†ç³»ç»Ÿ
- âŒ **åˆ›å»ºå¤šä½™çš„index.jsæ–‡ä»¶** - å°†å¯¼è‡´ï¼š
  - Strapi 5.xè·¯ç”±å†²çª
  - APIè¿”å›ž404é”™è¯¯
  - ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨

#### **âš ï¸ ä¸¥é‡é”™è¯¯çº§åˆ«ï¼ˆå¯¼è‡´åŠŸèƒ½å¼‚å¸¸ï¼‰**
- âŒ **å¿˜è®°æƒé™é…ç½®** - å°†å¯¼è‡´APIæ— æ³•è®¿é—®ï¼Œå‰ç«¯é›†æˆå¤±è´¥
- âŒ **ä¸éªŒè¯APIç«¯ç‚¹** - å¯èƒ½å­˜åœ¨é…ç½®é”™è¯¯ï¼Œå½±å“ç”Ÿäº§çŽ¯å¢ƒ
- âŒ **ä¸æ¸…é™¤ç¼“å­˜é‡å¯** - é…ç½®ä¸ç”Ÿæ•ˆï¼Œæµªè´¹è°ƒè¯•æ—¶é—´

#### **ðŸ”¥ å¼ºåˆ¶æ‰§è¡ŒéªŒè¯å‘½ä»¤**
```bash
# åˆ›å»ºå†…å®¹ç±»åž‹åŽï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹éªŒè¯å‘½ä»¤ï¼š
echo "ðŸš¨ å¼€å§‹å¼ºåˆ¶éªŒè¯æ–°å»ºå†…å®¹ç±»åž‹é…ç½®..."

# 1. éªŒè¯æ•°æ®åº“æ³¨é‡Š
echo "1ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“æ³¨é‡Š..."
psql -U aibianx_dev -d aibianx_dev -c "
SELECT 
    t.table_name,
    obj_description(c.oid) as table_comment,
    COUNT(col_description(c.oid, a.attnum)) as commented_columns,
    COUNT(a.attname) as total_columns
FROM information_schema.tables t
LEFT JOIN pg_class c ON c.relname = t.table_name
LEFT JOIN pg_attribute a ON a.attrelid = c.oid AND a.attnum > 0
WHERE t.table_name = '${table_name}'
GROUP BY t.table_name, c.oid;
"

# 2. éªŒè¯å­—æ®µæè¿°é…ç½®
echo "2ï¸âƒ£ æ£€æŸ¥å­—æ®µæè¿°é…ç½®..."
psql -U aibianx_dev -d aibianx_dev -c "
SELECT 
    key,
    jsonb_object_keys(value::jsonb->'metadatas') as configured_fields
FROM strapi_core_store_settings 
WHERE key LIKE '%${content_type}%'
  AND key LIKE '%content_types%';
"

# 3. éªŒè¯APIæƒé™
echo "3ï¸âƒ£ æ£€æŸ¥APIæƒé™é…ç½®..."
curl -s "http://localhost:1337/api/${content_type}s" | head -n 5

# 4. éªŒè¯Adminç•Œé¢
echo "4ï¸âƒ£ è¯·æ‰‹åŠ¨æ£€æŸ¥Adminç•Œé¢å­—æ®µæè¿°æ˜¯å¦æ˜¾ç¤ºä¸­æ–‡ï¼"
echo "   è®¿é—®: http://localhost:1337/admin/content-manager/collection-types/api::${content_type}.${content_type}"

echo "âœ… éªŒè¯å®Œæˆï¼å¦‚æœ‰ä»»ä½•é¡¹ç›®å¤±è´¥ï¼Œå¿…é¡»é‡æ–°æ‰§è¡Œé…ç½®æµç¨‹ï¼"
```

### **ðŸ› ï¸ å¼ºåˆ¶è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼ˆæŽ¨èä½¿ç”¨ï¼‰**

#### **æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæŽ¨èï¼‰**
```bash
# ðŸš€ åˆ›å»ºå†…å®¹ç±»åž‹å®Œæ•´é…ç½®è„šæœ¬ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
./scripts.sh content-type configure [content-type-name]

# ðŸŽ¯ è¯¥è„šæœ¬å¼ºåˆ¶æ‰§è¡Œä»¥ä¸‹æ‰€æœ‰æ­¥éª¤ï¼š
# 1. ðŸ—ƒï¸ æ•°æ®åº“è¡¨å’Œå­—æ®µæ³¨é‡Šè‡ªåŠ¨æ·»åŠ ï¼ˆ100%è¦†ç›–ï¼‰
# 2. ðŸŽ¨ Adminç•Œé¢å­—æ®µæè¿°è‡ªåŠ¨é…ç½®ï¼ˆä¸­æ–‡æ˜¾ç¤ºï¼‰
# 3. ðŸ” APIæƒé™è‡ªåŠ¨é…ç½®ï¼ˆPublic + Authenticatedï¼‰
# 4. ðŸ”„ æœåŠ¡è‡ªåŠ¨é‡å¯å’Œç¼“å­˜æ¸…ç†
# 5. âœ… å®Œæ•´æ€§éªŒè¯æ£€æŸ¥ï¼ˆæ•°æ®åº“+API+ç•Œé¢ï¼‰
# 6. ðŸ“‹ ç”ŸæˆéªŒè¯æŠ¥å‘Š

# ðŸŽ¯ å¦‚éœ€æ‰‹åŠ¨é…ç½®ï¼Œå¯ä½¿ç”¨çŽ°æœ‰å·¥å…·ï¼š
./scripts.sh tools fix-fields-any [content-type-name]  # å­—æ®µæè¿°é…ç½®
psql -U aibianx_dev -d aibianx_dev -f add-comments.sql  # æ•°æ®åº“æ³¨é‡Š
```

#### **æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨å¼ºåˆ¶æ‰§è¡Œï¼ˆè„šæœ¬ä¸å­˜åœ¨æ—¶ï¼‰**
```bash
# ðŸš¨ å½“è‡ªåŠ¨åŒ–è„šæœ¬ä¸å­˜åœ¨æ—¶ï¼Œå¿…é¡»æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨æ‰§è¡Œï¼š

# 1. åˆ›å»ºæ•°æ®åº“æ³¨é‡Šè„šæœ¬å¹¶æ‰§è¡Œ
content_type="your-content-type"
table_name="${content_type//-/_}s"  # è½¬æ¢å‘½åæ ¼å¼

cat > backend/add-db-comments-${content_type}.sql << EOF
-- æ•°æ®åº“æ³¨é‡Š - ${content_type}
COMMENT ON TABLE ${table_name} IS '${content_type}ç®¡ç†è¡¨ - è¯¦ç»†æè¿°æ­¤è¡¨çš„ç”¨é€”';
-- ä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ æ³¨é‡Šï¼ˆæ ¹æ®å®žé™…schema.jsonå­—æ®µï¼‰
COMMENT ON COLUMN ${table_name}.id IS 'ä¸»é”®ID';
COMMENT ON COLUMN ${table_name}.created_at IS 'åˆ›å»ºæ—¶é—´';
COMMENT ON COLUMN ${table_name}.updated_at IS 'æ›´æ–°æ—¶é—´';
-- ... æ·»åŠ å…¶ä»–å­—æ®µæ³¨é‡Š
EOF

psql -U aibianx_dev -d aibianx_dev -f backend/add-db-comments-${content_type}.sql

# 2. åˆ›å»ºå­—æ®µæè¿°é…ç½®è„šæœ¬å¹¶æ‰§è¡Œ
cat > backend/update-field-descriptions-${content_type}.sql << EOF
-- å­—æ®µæè¿°é…ç½® - ${content_type}
-- ä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ ä¸­æ–‡æè¿°ï¼ˆæ ¹æ®å®žé™…schema.jsonå­—æ®µï¼‰
UPDATE strapi_core_store_settings 
SET value = jsonb_set(
    value::jsonb, 
    '{metadatas,å­—æ®µå,edit,description}', 
    '"å­—æ®µçš„ä¸­æ–‡æè¿°è¯´æ˜Ž"'
) 
WHERE key = 'plugin_content_manager_configuration_content_types::api::${content_type}.${content_type}';
-- ... ä¸ºå…¶ä»–å­—æ®µæ·»åŠ æè¿°
EOF

psql -U aibianx_dev -d aibianx_dev -f backend/update-field-descriptions-${content_type}.sql

# 3. å¼ºåˆ¶æ¸…é™¤ç¼“å­˜å¹¶é‡å¯
./scripts.sh deploy stop
rm -rf backend/.tmp backend/.cache backend/build backend/dist
./scripts.sh deploy start

# 4. å¼ºåˆ¶éªŒè¯é…ç½®ç»“æžœ
echo "ðŸ” éªŒè¯é…ç½®ç»“æžœ..."
# éªŒè¯æ•°æ®åº“æ³¨é‡Š
psql -U aibianx_dev -d aibianx_dev -c "
SELECT obj_description('${table_name}'::regclass) as table_comment;
"
# éªŒè¯APIè®¿é—®
curl -s "http://localhost:1337/api/${content_type}s" | head -n 3
echo "âœ… è¯·æ‰‹åŠ¨æ£€æŸ¥Adminç•Œé¢æ˜¯å¦æ˜¾ç¤ºä¸­æ–‡å­—æ®µæè¿°ï¼"
```

#### **ðŸš¨ éªŒæ”¶æ ‡å‡†ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰**

**åœ¨å®Œæˆé…ç½®åŽï¼Œå¿…é¡»é€šè¿‡ä»¥ä¸‹éªŒæ”¶æ ‡å‡†ï¼Œä»»ä½•ä¸€é¡¹å¤±è´¥éƒ½å¿…é¡»é‡æ–°é…ç½®ï¼š**

1. **æ•°æ®åº“æ³¨é‡ŠéªŒæ”¶**ï¼š
   - âœ… è¡¨æ³¨é‡Šå­˜åœ¨ä¸”ä¸ºä¸­æ–‡æè¿°
   - âœ… æ‰€æœ‰å­—æ®µæ³¨é‡Šå­˜åœ¨ä¸”ä¸ºä¸­æ–‡æè¿°
   - âœ… å…³è”è¡¨æ³¨é‡Šå®Œæ•´

2. **Adminç•Œé¢éªŒæ”¶**ï¼š
   - âœ… æ‰€æœ‰å­—æ®µæ˜¾ç¤ºä¸­æ–‡æè¿°
   - âœ… å­—æ®µæ ‡ç­¾ä¸ºä¸­æ–‡
   - âœ… å¤æ‚å­—æ®µæœ‰å¸®åŠ©æ–‡æœ¬

3. **APIè®¿é—®éªŒæ”¶**ï¼š
   - âœ… GET /api/${content_type}s è¿”å›ž200çŠ¶æ€
   - âœ… GET /api/${content_type}s/:id è¿”å›ž200çŠ¶æ€
   - âœ… æ•°æ®ç»“æž„ç¬¦åˆé¢„æœŸ

4. **æƒé™é…ç½®éªŒæ”¶**ï¼š
   - âœ… Publicè§’è‰²æœ‰findå’ŒfindOneæƒé™
   - âœ… Authenticatedè§’è‰²æœ‰å®Œæ•´CRUDæƒé™